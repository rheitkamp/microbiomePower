colnames(PUpperFallS3) <- "Mean"
PUpperFallS4 <- matrix(PUpperFallS4)
rownames(PUpperFallS4) <-  c("Proteobacteria", "Firmicutes", "Bacteroidetes", "Actinobacteria", "Fusobacteria", "Cyanobacteria",
"OD1", "TM7", "Deinococcus.Thermus", "Nirtospira", "Planctomycetes", "Chloroflexi", "BRC1")
colnames(PUpperFallS4) <- "Mean"
PUpperFallS5 <- matrix(PUpperFallS5)
rownames(PUpperFallS5) <-  c("Proteobacteria", "Firmicutes", "Bacteroidetes", "Actinobacteria", "Fusobacteria", "Cyanobacteria",
"OD1", "TM7", "Deinococcus.Thermus", "Nirtospira", "Planctomycetes", "Chloroflexi", "BRC1")
colnames(PUpperFallS5) <- "Mean"
S1PSD <- data.frame(PUpperFallS1, SDS1)
S2PSD <- data.frame(PUpperFallS2, SDS2)
S3PSD <- data.frame(PUpperFallS3, SDS3)
S4PSD <- data.frame(PUpperFallS4, SDS4)
S5PSD <- data.frame(PUpperFallS5, SDS5)
getBetaParams <- function(mean, sd) {
m <- (1-mean)/mean
n <- 1 + m
alpha <- (1/n)*(m/(sd^2*n^2)-1)
beta <- m * alpha
params <- list(type=1, a=alpha, b=beta, location=0, scale=1)
return(params)
}
S1parProteo <- getBetaParams(S1PSD[1,1], S1PSD[1,2])
S1parFirm <- getBetaParams(S1PSD[2,1], S1PSD[2,2])
S1parBact <- getBetaParams(S1PSD[3,1], S1PSD[3,2])
S1parActino <- getBetaParams(S1PSD[4,1], S1PSD[4,2])
S2parProteo <- getBetaParams(S2PSD[1,1], S1PSD[1,2])
S2parFirm <- getBetaParams(S2PSD[2,1], S1PSD[2,2])
S2parBact <- getBetaParams(S2PSD[3,1], S2PSD[3,2])
S2parActino <- getBetaParams(S2PSD[4,1], S2PSD[4,2])
S3parProteo <- getBetaParams(S3PSD[1,1], S3PSD[1,2])
S3parFirm <- getBetaParams(S3PSD[2,1], S3PSD[2,2])
S3parBact <- getBetaParams(S3PSD[3,1], S3PSD[3,2])
S4parActino <- getBetaParams(S3PSD[4,1], S3PSD[4,2])
S4parProteo <- getBetaParams(S4PSD[1,1], S4PSD[1,2])
S4parFirm <- getBetaParams(S4PSD[2,1], S4PSD[2,2])
S4parBact <- getBetaParams(S4PSD[3,1], S4PSD[3,2])
S4parActino <- getBetaParams(S4PSD[4,1], S4PSD[4,2])
S5parProteo <- getBetaParams(S5PSD[1,1], S5PSD[1,2])
S5parFirm <- getBetaParams(S5PSD[2,1], S5PSD[2,2])
S5parBact <- getBetaParams(S5PSD[3,1], S5PSD[3,2])
S5parActino <- getBetaParams(S5PSD[4,1], S5PSD[4,2])
numrow <- 50
numcol <- dim(PUpperFallS1)[1]
UpperRepS1 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS1) <- dimnames(PUpperFallS1)[[1]]
rownames(UpperRepS1) <- rownames(UpperRepS1, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS1)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS1[i,1] <- rpearson(n=1, params=S1parProteo)
total <- total - UpperRepS1[i,1]
###Firmicutes
r <- rpearson(n=1, params=S1parFirm)
UpperRepS1[i,2] <- total*r
total <- total - UpperRepS1[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S1parBact)
UpperRepS1[i,3] <- total*r
total <- total - UpperRepS1[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S1parActino)
UpperRepS1[i,4] <- total*r
total <- total - UpperRepS1[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS1[i,5] <- total*r
total <- total - UpperRepS1[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS1[i,6] <- total*r
total <- total - UpperRepS1[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS1[i,7] <- total*r
total <- total - UpperRepS1[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS1[i,8] <- total*r
total <- total - UpperRepS1[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS1[i,9] <- total*r
total <- total - UpperRepS1[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS1[i,10] <- total*r
total <- total - UpperRepS1[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS1[i,11] <- total*r
###Chloroflexi
UpperRepS1[i,12] <- total - UpperRepS1[i,11]
###BRC1
UpperRepS1[1:numrow,13] <- 0
}
barchart(x=UpperRepS1,horizontal=FALSE, col=rainbow(13))
######
##S2##
######
numrow <- 50
numcol <- dim(PUpperFallS2)[1]
UpperRepS2 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS2) <- dimnames(PUpperFallS2)[[1]]
rownames(UpperRepS2) <- rownames(UpperRepS2, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS2)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS2[i,1] <- rpearson(n=1, params=S2parProteo)
total <- total - UpperRepS2[i,1]
###Firmicutes
r <- rpearson(n=1, params=S2parFirm)
UpperRepS2[i,2] <- total*r
total <- total - UpperRepS2[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S2parBact)
UpperRepS2[i,3] <- total*r
total <- total - UpperRepS2[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S2parActino)
UpperRepS2[i,4] <- total*r
total <- total - UpperRepS2[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS2[i,5] <- total*r
total <- total - UpperRepS2[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS2[i,6] <- total*r
total <- total - UpperRepS2[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS2[i,7] <- total*r
total <- total - UpperRepS2[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS2[i,8] <- total*r
total <- total - UpperRepS2[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS2[i,9] <- total*r
total <- total - UpperRepS2[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS2[i,10] <- total*r
total <- total - UpperRepS2[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS2[i,11] <- total*r
###Chloroflexi
UpperRepS2[i,12] <- total - UpperRepS2[i,11]
###BRC1
UpperRepS2[1:numrow,13] <- 0
}
barchart(x=UpperRepS2,horizontal=FALSE, col=rainbow(13))
numrow <- 50
numcol <- dim(PUpperFallS3)[1]
UpperRepS3 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS3) <- dimnames(PUpperFallS3)[[1]]
rownames(UpperRepS3) <- rownames(UpperRepS3, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS3)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS3[i,1] <- rpearson(n=1, params=S3parProteo)
total <- total - UpperRepS3[i,1]
###Firmicutes
r <- rpearson(n=1, params=S3parFirm)
UpperRepS3[i,2] <- total*r
total <- total - UpperRepS3[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S3parBact)
UpperRepS3[i,3] <- total*r
total <- total - UpperRepS3[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S3parActino)
UpperRepS3[i,4] <- total*r
total <- total - UpperRepS3[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS3[i,5] <- total*r
total <- total - UpperRepS3[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS3[i,6] <- total*r
total <- total - UpperRepS3[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS3[i,7] <- total*r
total <- total - UpperRepS3[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS3[i,8] <- total*r
total <- total - UpperRepS3[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS3[i,9] <- total*r
total <- total - UpperRepS3[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS3[i,10] <- total*r
total <- total - UpperRepS3[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS3[i,11] <- total*r
###Chloroflexi
UpperRepS3[i,12] <- total - UpperRepS3[i,11]
###BRC1
UpperRepS3[1:numrow,13] <- 0
}
S3parActino <- getBetaParams(S3PSD[4,1], S3PSD[4,2])
numrow <- 50
numcol <- dim(PUpperFallS3)[1]
UpperRepS3 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS3) <- dimnames(PUpperFallS3)[[1]]
rownames(UpperRepS3) <- rownames(UpperRepS3, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS3)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS3[i,1] <- rpearson(n=1, params=S3parProteo)
total <- total - UpperRepS3[i,1]
###Firmicutes
r <- rpearson(n=1, params=S3parFirm)
UpperRepS3[i,2] <- total*r
total <- total - UpperRepS3[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S3parBact)
UpperRepS3[i,3] <- total*r
total <- total - UpperRepS3[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S3parActino)
UpperRepS3[i,4] <- total*r
total <- total - UpperRepS3[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS3[i,5] <- total*r
total <- total - UpperRepS3[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS3[i,6] <- total*r
total <- total - UpperRepS3[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS3[i,7] <- total*r
total <- total - UpperRepS3[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS3[i,8] <- total*r
total <- total - UpperRepS3[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS3[i,9] <- total*r
total <- total - UpperRepS3[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS3[i,10] <- total*r
total <- total - UpperRepS3[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS3[i,11] <- total*r
###Chloroflexi
UpperRepS3[i,12] <- total - UpperRepS3[i,11]
###BRC1
UpperRepS3[1:numrow,13] <- 0
}
barchart(x=UpperRepS3,horizontal=FALSE, col=rainbow(13))
numrow <- 50
numcol <- dim(PUpperFallS4)[1]
UpperRepS4 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS4) <- dimnames(PUpperFallS4)[[1]]
rownames(UpperRepS4) <- rownames(UpperRepS4, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS4)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS4[i,1] <- rpearson(n=1, params=S4parProteo)
total <- total - UpperRepS4[i,1]
###Firmicutes
r <- rpearson(n=1, params=S4parFirm)
UpperRepS4[i,2] <- total*r
total <- total - UpperRepS4[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S4parBact)
UpperRepS4[i,3] <- total*r
total <- total - UpperRepS4[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S4parActino)
UpperRepS4[i,4] <- total*r
total <- total - UpperRepS4[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS4[i,5] <- total*r
total <- total - UpperRepS4[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS4[i,6] <- total*r
total <- total - UpperRepS4[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS4[i,7] <- total*r
total <- total - UpperRepS4[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS4[i,8] <- total*r
total <- total - UpperRepS4[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS4[i,9] <- total*r
total <- total - UpperRepS4[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS4[i,10] <- total*r
total <- total - UpperRepS4[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS4[i,11] <- total*r
###Chloroflexi
UpperRepS4[i,12] <- total - UpperRepS4[i,11]
###BRC1
UpperRepS4[1:numrow,13] <- 0
}
barchart(x=UpperRepS4,horizontal=FALSE, col=rainbow(13))
numrow <- 50
numcol <- dim(PUpperFallS5)[1]
UpperRepS5 <- matrix(nrow=numrow,ncol=numcol)
colnames(UpperRepS5) <- dimnames(PUpperFallS5)[[1]]
rownames(UpperRepS5) <- rownames(UpperRepS5, do.NULL= FALSE, prefix= "Sample")
size <- dim(UpperRepS5)[1]
for (i in 1:size){
total <- 1
###Proteobacteria
UpperRepS5[i,1] <- rpearson(n=1, params=S5parProteo)
total <- total - UpperRepS5[i,1]
###Firmicutes
r <- rpearson(n=1, params=S5parFirm)
UpperRepS5[i,2] <- total*r
total <- total - UpperRepS5[i,2]
###Bacteroidetes
r <- rpearson(n=1, params=S5parBact)
UpperRepS5[i,3] <- total*r
total <- total - UpperRepS5[i,3]
###Actinobacteria
r <- rpearson(n=1, params=S5parActino)
UpperRepS5[i,4] <- total*r
total <- total - UpperRepS5[i,4]
###Fusobacteria
r <- rpearsonI(n=1, a=381.28608,  b=88.02261, location=0, scale=1)
UpperRepS5[i,5] <- total*r
total <- total - UpperRepS5[i,5]
###Cyanobacteria
r <- rpearsonI(n=1, a=7651.471, b=3797.397, location=0, scale=1)
UpperRepS5[i,6] <- total*r
total <- total - UpperRepS5[i,6]
###OD1
r <- rpearsonI(n=1, a=169009.8, b=169009.8, location=0, scale=1)
UpperRepS5[i,7] <- total*r
total <- total - UpperRepS5[i,7]
###TM7
r <- rpearsonI(n=1, a=15922.282, b=7784.227, location=0, scale=1)
UpperRepS5[i,8] <- total*r
total <- total - UpperRepS5[i,8]
###Deinococcus-Thermus
r <- rpearsonI(n=1, a=1643500.4, b=766966.9, location=0, scale=1)
UpperRepS5[i,9] <- total*r
total <- total - UpperRepS5[i,9]
###Nitrospira
r <- rpearsonI(n=1, a=10123096, b=4049238, location=0, scale=1)
UpperRepS5[i,10] <- total*r
total <- total - UpperRepS5[i,10]
###Planctomycetes
r <- rpearsonI(n=1, a=19531249, b=19531249, location=0, scale=1)
UpperRepS5[i,11] <- total*r
###Chloroflexi
UpperRepS5[i,12] <- total - UpperRepS5[i,11]
###BRC1
UpperRepS5[1:numrow,13] <- 0
}
barchart(x=UpperRepS5,horizontal=FALSE, col=rainbow(13))
set.seed(123)
Fall <- read.csv("pUpperRepFall.csv")
Fallreads <- Fall*11000
Fallreads <- Fallreads[1:12]
S2reads <- UpperRepS2*11000
UpperRepS2 <- read.csv("UpperRepS2.csv")
S2reads <- UpperRepS2*11000
S2reads <- S2reads[,1:12]
comb=rbind(Gp1,Gp2)
index=which(colSums(comb)==0)
if(length(index)>0){
Gp1=Gp1[,-index]
Gp2=Gp2[,-index]
}
#Computing and visualizing taxa frequency means for each group
mygroup <- list(Gp1,Gp2)
names(mygroup)<-c('Fall','S2')
Sites.pi.MoM=do.call(rbind,lapply(mygroup,function(x) DM.MoM(x)$pi))
Sites.pi.MoM=Sites.pi.MoM[,order(abs(Sites.pi.MoM[1,]-Sites.pi.MoM[2,]),decreasing=T)]
#Ploting taxa frequency means
matplot(t(Sites.pi.MoM),type='o',pch=19,axes="FALSE", ann="FALSE",col=c('blue','red'),ylim=c(-0.25,1))
y=colnames(Sites.pi.MoM)
nc=dim((Sites.pi.MoM))[2]
axis(1,at=1:nc, lab=F, hadj=3,pos=-0.009)
text(1:nc,-0.02, srt=90,adj=1,labels=y,xpd=T, cex=1)
axis(2, las=1, at=seq(0,1,0.05))
legend("topright",legend=c(rownames(Sites.pi.MoM)), cex=0.8, col=c('blue','red'), bty="n",pch=19)
text(-1.5,0.01,srt=90,adj=-1,labels='Taxa Abundance',xpd=T, cex=1)
#text(21,-0.01,srt=0,adj=0,labels='Taxa Abundance',cex=1)
#Selecting taxa with weigthed average across groups above 1%
#On one part this is to facilitate convergence of the test statistics to the asymptotic
#distribution and being able to use the properties of this distribution to answer the hypothesis
#On a second part, this is also motivated by the uncertainty regarding the abundance of rare taxa,
#meaning, we do not know if their abundances are correct or not.
fit1=DM.MoM(Gp1)
fit2=DM.MoM(Gp2)
fit1$reads=apply(Gp1,1,sum)
fit2$reads=apply(Gp2,1,sum)
group.data <- list(Gp1, Gp2)
pio <- pioest(group.data)
C.alpha.multinomial(Gp1)
C.alpha.multinomial(Gp2)
#Fitting DM
fit1=DM.MoM((Gp1))
fit2=DM.MoM((Gp2))
fit1$reads=colSums(Gp1)
fit2$reads=colSums(Gp2)
#Ploting
Sites.pi.MoMsel=rbind(fit1$pi,fit2$pi)
Sites.pi.MoMsel=Sites.pi.MoMsel[,order(abs(Sites.pi.MoMsel[1,]-Sites.pi.MoMsel[2,]),decreasing=T)]
rownames(Sites.pi.MoMsel)<-rownames(Sites.pi.MoM)
matplot(t(Sites.pi.MoMsel),type='o',pch=19,axes="FALSE", ann="FALSE",col=c('blue','red'),ylim=c(-0.25,0.6))
y=colnames(Sites.pi.MoMsel)
nc=dim((Sites.pi.MoMsel))[2]
axis(1,at=1:nc, lab=F, hadj=3,pos=-0.009)
text(1:nc,-0.02, srt=90,adj=1,labels=y,xpd=T, cex=1)
axis(2, las=1, at=seq(0,0.6,0.05))
legend("topright",legend=c(rownames(Sites.pi.MoMsel)), cex=0.8, col=c('blue','red'), bty="n",pch=19)
text(-1.5,0.01,srt=90,adj=-1,labels='Taxa Abundance',xpd=T, cex=1)
#text(21,-0.01,srt=0,adj=0,labels='Taxa Abundance',cex=1)
#Comparing the taxa frequency mean across groups
pvalue<-Xmcupo.sevsample(mygroup,dim(Gp2)[2])
pvalue
#Power calculation procedure
pi_2gr=rbind(fit1$pi, fit2$pi)
group.theta=c(fit1$theta,fit2$theta)
Fallreads <- Fall*11000
Fallreads <- Fallreads[1:12]
UpperRepS2 <- read.csv("UpperRepS2.csv")
S2reads <- UpperRepS2*11000
S2reads <- S2reads[,1:12]
Gp1=Fallreads
Gp2=S2reads
comb=rbind(Gp1,Gp2)
index=which(colSums(comb)==0)
if(length(index)>0){
Gp1=Gp1[,-index]
Gp2=Gp2[,-index]
}
mygroup <- list(Gp1,Gp2)
names(mygroup)<-c('Fall','S2')
Sites.pi.MoM=do.call(rbind,lapply(mygroup,function(x) DM.MoM(x)$pi))
Sites.pi.MoM=Sites.pi.MoM[,order(abs(Sites.pi.MoM[1,]-Sites.pi.MoM[2,]),decreasing=T)]
matplot(t(Sites.pi.MoM),type='o',pch=19,axes="FALSE", ann="FALSE",col=c('blue','red'),ylim=c(-0.25,1))
y=colnames(Sites.pi.MoM)
nc=dim((Sites.pi.MoM))[2]
axis(1,at=1:nc, lab=F, hadj=3,pos=-0.009)
text(1:nc,-0.02, srt=90,adj=1,labels=y,xpd=T, cex=1)
axis(2, las=1, at=seq(0,1,0.05))
legend("topright",legend=c(rownames(Sites.pi.MoM)), cex=0.8, col=c('blue','red'), bty="n",pch=19)
text(-1.5,0.01,srt=90,adj=-1,labels='Taxa Abundance',xpd=T, cex=1)
fit1=DM.MoM(Gp1)
fit2=DM.MoM(Gp2)
fit1$reads=apply(Gp1,1,sum)
fit2$reads=apply(Gp2,1,sum)
group.data <- list(Gp1, Gp2)
pio <- pioest(group.data)
taxaselection=which(pio>0.01)
Gp1sel=cbind(Gp1[,taxaselection],rowSums(Gp1[,-taxaselection]))
Gp2sel=cbind(Gp2[,taxaselection],rowSums(Gp2[,-taxaselection]))
nc=dim(Gp1sel)[2]
colnames(Gp1sel)[nc]<-'Pooled taxa'
colnames(Gp2sel)[nc]<-'Pooled taxa'
Fall <- read.csv("pUpperRepFall.csv")
Fallreads <- Fall*11000
Fallreads <- Fallreads[1:12]
Fall
UpperRepS1 <- read.csv("UpperRepS1.csv")
S1reads <- UpperRepS1*11000
S1reads <- S1reads[,1:12]
Gp1=Fallreads
Gp2=S1reads
comb=rbind(Gp1,Gp2)
index=which(colSums(comb)==0)
if(length(index)>0){
Gp1=Gp1[,-index]
Gp2=Gp2[,-index]
}
mygroup <- list(Gp1,Gp2)
names(mygroup)<-c('Fall','S2')
Sites.pi.MoM=do.call(rbind,lapply(mygroup,function(x) DM.MoM(x)$pi))
Sites.pi.MoM=Sites.pi.MoM[,order(abs(Sites.pi.MoM[1,]-Sites.pi.MoM[2,]),decreasing=T)]
matplot(t(Sites.pi.MoM),type='o',pch=19,axes="FALSE", ann="FALSE",col=c('blue','red'),ylim=c(-0.25,1))
y=colnames(Sites.pi.MoM)
nc=dim((Sites.pi.MoM))[2]
axis(1,at=1:nc, lab=F, hadj=3,pos=-0.009)
text(1:nc,-0.02, srt=90,adj=1,labels=y,xpd=T, cex=1)
axis(2, las=1, at=seq(0,1,0.05))
legend("topright",legend=c(rownames(Sites.pi.MoM)), cex=0.8, col=c('blue','red'), bty="n",pch=19)
text(-1.5,0.01,srt=90,adj=-1,labels='Taxa Abundance',xpd=T, cex=1)
#text(21,-0.01,srt=0,adj=0,labels='Taxa Abundance',cex=1)
